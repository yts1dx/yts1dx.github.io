
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Yan Tingshuai's Blog</title>
  <meta name="author" content="Yan Tingshuai">

  
  <meta name="description" content="问题 何时需要使用select for update 当需要实现atomic的read &amp; write的场景时可能需要使用到select for update。之所以说是可能，是因为受数据库隔离级别和并发控制实现影响。 下面这段阐述了不同DB下隔离级别的影响 In Oracle and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yts1dx.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Yan Tingshuai's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> -->
  <script src="//ajax.useso.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!-- <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->
<!-- <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->
<link href="//fonts.useso.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.useso.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Yan Tingshuai's Blog</a></h1>
  
    <h2>A Blog of SQLer.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.baidu.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="yts1dx.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/08/14/the-use-of-select-for-update/">The Use of Select for Update</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-08-14T17:56:44+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>5:56 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>问题</h3>

<h4>何时需要使用select for update</h4>

<p>当需要实现atomic的read &amp; write的场景时<strong>可能</strong>需要使用到select for update。之所以说是可能，是因为受数据库<strong>隔离级别</strong>和<strong>并发控制</strong>实现影响。</p>

<p>下面这段阐述了不同DB下<strong>隔离级别</strong>的影响</p>

<blockquote><p>In Oracle and earlier PostgreSQL versions, REPEATABLE READ is actually a synonym for SERIALIZABLE. Basically, this means that the transaction does not see changes made after it has started. So in this setup, the last Thread 1 query will return the room as if it has never been deleted (which may or may not be what you wanted). If you don&rsquo;t want to show the rooms after they have been deleted, you should lock the rows with SELECT FOR UPDATE</p>

<p>In InnoDB, REPEATABLE READ and SERIALIZABLE are different things: readers in SERIALIZABLE mode set next-key locks on the records they evaluate, effectively preventing the concurrent DML on them. So you don&rsquo;t need a SELECT FOR UPDATE in serializable mode, but do need them in REPEATABLE READ or READ COMMITED.</p></blockquote>

<p>例如下面就是对不同<strong>并发控制</strong>下的选择：</p>

<blockquote><p>MyISAM in MySQL (and several other old systems) does lock the whole table for the duration of a query.</p>

<p>In SQL Server, SELECT queries place shared locks on the records / pages / tables they have examined, while DML queries place update locks (which later get promoted to exclusive or demoted to shared locks). Exclusive locks are incompatible with shared locks, so either SELECT or DELETE query will lock until another session commits.</p>

<p>In databases which use MVCC (like Oracle, PostgreSQL, MySQL with InnoDB), a DML query creates a copy of the record (in one or another way) and generally readers do not block writers and vice versa. For these databases, a SELECT FOR UPDATE would come handy: it would lock either SELECT or the DELETE query until another session commits, just as SQL Server does.</p></blockquote>

<h3>参考资料</h3>

<p><a href="http://stackoverflow.com/questions/10935850/when-to-use-select-for-update">When to use SELECT … FOR UPDATE?</a>
<a href="http://dev.mysql.com/doc/refman/5.7/en/innodb-locking-reads.html">Mysql Lock Read</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/06/19/oracle-create-outlinegong-neng/">Oracle Create Outline功能</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-19T21:04:08+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:04 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>oracle中outline相关系统表</h1>

<ul>
<li>USER_OUTLINES</li>
<li>USER_OUTLINE_HINTS</li>
<li>ALL_OUTLINES</li>
<li>ALL_OUTLINE_HINTS</li>
<li>DBA_OUTLINES</li>
<li>DBA_OUTLINE_HINTS</li>
</ul>


<h1>create outline没有指定hint时的生成结果</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="n">outline</span> <span class="n">ol_1</span> <span class="k">FOR</span> <span class="n">CATEGORY</span> <span class="n">test</span> <span class="k">on</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="n">created</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">user_outline_hints</span> <span class="k">where</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;OL_1&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">NAME</span>                    <span class="n">NODE</span>      <span class="n">STAGE</span>   <span class="n">JOIN_POS</span> <span class="n">HINT</span>
</span><span class='line'><span class="c1">------------------------------ ---------- ---------- ---------- --------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">OL_1</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">USE_MERGE_CARTESIAN</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="ss">&quot;T2&quot;</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_1</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="k">LEADING</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="ss">&quot;T1&quot;</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="ss">&quot;T2&quot;</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_1</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">2</span> <span class="k">FULL</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="ss">&quot;T2&quot;</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_1</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">1</span> <span class="k">FULL</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="ss">&quot;T1&quot;</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_1</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">OUTLINE_LEAF</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_1</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">ALL_ROWS</span>
</span><span class='line'><span class="n">OL_1</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">DB_VERSION</span><span class="p">(</span><span class="s1">&#39;11.2.0.2&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_1</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">OPTIMIZER_FEATURES_ENABLE</span><span class="p">(</span><span class="s1">&#39;11.2.0.2&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_1</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'>
</span><span class='line'><span class="mi">9</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>可见，没有指定hint时，create outline的结果是根据plan生成的。</p>

<h1>指定错误hint时，create outline的结果</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="n">outline</span> <span class="n">ol_2</span> <span class="k">FOR</span> <span class="n">CATEGORY</span> <span class="n">test</span> <span class="k">on</span> <span class="k">select</span> <span class="cm">/*+ssssssss*/</span><span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="n">created</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">user_outline_hints</span> <span class="k">where</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;OL_2&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">NAME</span>                    <span class="n">NODE</span>      <span class="n">STAGE</span>   <span class="n">JOIN_POS</span> <span class="n">HINT</span>
</span><span class='line'><span class="c1">------------------------------ ---------- ---------- ---------- --------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">OL_2</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">USE_MERGE_CARTESIAN</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="ss">&quot;T2&quot;</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_2</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="k">LEADING</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="ss">&quot;T1&quot;</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="ss">&quot;T2&quot;</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_2</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">2</span> <span class="k">FULL</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="ss">&quot;T2&quot;</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_2</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">1</span> <span class="k">FULL</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="ss">&quot;T1&quot;</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_2</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">OUTLINE_LEAF</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_2</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">ALL_ROWS</span>
</span><span class='line'><span class="n">OL_2</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">DB_VERSION</span><span class="p">(</span><span class="s1">&#39;11.2.0.2&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_2</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">OPTIMIZER_FEATURES_ENABLE</span><span class="p">(</span><span class="s1">&#39;11.2.0.2&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_2</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span></code></pre></td></tr></table></div></figure>


<p>可见，写一个无效的hint，在oracle中并不会报错，并且不会影响outline的生成结果</p>

<h1>指定一个未创建的index，但是create outline后，创建该index</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">index</span> <span class="n">t3_idx_1</span> <span class="k">on</span> <span class="n">t3</span><span class="p">(</span><span class="n">c2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">Index</span> <span class="n">created</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">index_name</span><span class="p">,</span> <span class="n">include_column</span> <span class="k">from</span> <span class="n">user_indexes</span> <span class="k">where</span> <span class="k">table_name</span> <span class="o">=</span><span class="s1">&#39;T3&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">INDEX_NAME</span>            <span class="n">INCLUDE_COLUMN</span>
</span><span class='line'><span class="c1">------------------------------ --------------</span>
</span><span class='line'><span class="n">T3_IDX_1</span>
</span></code></pre></td></tr></table></div></figure>


<p>当前T3上面，创建的索引，只有T3_IDX_1。接下来创建一个outline，指定一个不存在的索引T3_IDX_2.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="n">outline</span> <span class="n">OL_3</span> <span class="k">FOR</span> <span class="n">CATEGORY</span> <span class="n">test</span> <span class="k">on</span> <span class="k">select</span> <span class="cm">/*+index(T3 T3_IDX_2)*/</span> <span class="o">*</span> <span class="k">from</span> <span class="n">T3</span> <span class="k">where</span> <span class="n">c2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="n">created</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">user_outline_hints</span> <span class="k">where</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;OL_3&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">NAME</span>                    <span class="n">NODE</span>      <span class="n">STAGE</span>   <span class="n">JOIN_POS</span> <span class="n">HINT</span>
</span><span class='line'><span class="c1">------------------------------ ---------- ---------- ---------- --------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">OL_3</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">1</span> <span class="n">INDEX_RS_ASC</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="ss">&quot;T3&quot;</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="p">(</span><span class="ss">&quot;T3&quot;</span><span class="p">.</span><span class="ss">&quot;C2&quot;</span><span class="p">))</span>
</span><span class='line'><span class="n">OL_3</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">OUTLINE_LEAF</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_3</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">ALL_ROWS</span>
</span><span class='line'><span class="n">OL_3</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">DB_VERSION</span><span class="p">(</span><span class="s1">&#39;11.2.0.2&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_3</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">OPTIMIZER_FEATURES_ENABLE</span><span class="p">(</span><span class="s1">&#39;11.2.0.2&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_3</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'>
</span><span class='line'><span class="mi">6</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>根据上面的outline输出可以看见，使用了T3_IDX_1,此时创建新的索引T3_IDX_2.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">index</span> <span class="n">t3_idx_2</span> <span class="k">on</span> <span class="n">t3</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">Index</span> <span class="n">created</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">index_name</span><span class="p">,</span> <span class="n">include_column</span> <span class="k">from</span> <span class="n">user_indexes</span> <span class="k">where</span> <span class="k">table_name</span> <span class="o">=</span><span class="s1">&#39;T3&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">INDEX_NAME</span>            <span class="n">INCLUDE_COLUMN</span>
</span><span class='line'><span class="c1">------------------------------ --------------</span>
</span><span class='line'><span class="n">T3_IDX_2</span>
</span><span class='line'><span class="n">T3_IDX_1</span>
</span></code></pre></td></tr></table></div></figure>


<p>再次查看outline OL_3的情况</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">user_outline_hints</span> <span class="k">where</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;OL_3&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">NAME</span>                    <span class="n">NODE</span>      <span class="n">STAGE</span>   <span class="n">JOIN_POS</span> <span class="n">HINT</span>
</span><span class='line'><span class="c1">------------------------------ ---------- ---------- ---------- --------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">OL_3</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">1</span> <span class="n">INDEX_RS_ASC</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="ss">&quot;T3&quot;</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="p">(</span><span class="ss">&quot;T3&quot;</span><span class="p">.</span><span class="ss">&quot;C2&quot;</span><span class="p">))</span>
</span><span class='line'><span class="n">OL_3</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">OUTLINE_LEAF</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_3</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">ALL_ROWS</span>
</span><span class='line'><span class="n">OL_3</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">DB_VERSION</span><span class="p">(</span><span class="s1">&#39;11.2.0.2&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_3</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">OPTIMIZER_FEATURES_ENABLE</span><span class="p">(</span><span class="s1">&#39;11.2.0.2&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_3</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'>
</span><span class='line'><span class="mi">6</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>可见，仍旧使用的是T3_IDX_1. 那么检验一下T3_IDX_2是否能够生效, 再根据前面的语句创建一个OL_6</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="n">outline</span> <span class="n">OL_6</span> <span class="k">FOR</span> <span class="n">CATEGORY</span> <span class="n">test</span> <span class="k">on</span> <span class="k">select</span> <span class="cm">/*+index(T3 T3_IDX_2)*/</span> <span class="o">*</span> <span class="k">from</span> <span class="n">T3</span> <span class="k">where</span> <span class="n">c2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="n">created</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">user_outline_hints</span> <span class="k">where</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;OL_6&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">NAME</span>                    <span class="n">NODE</span>      <span class="n">STAGE</span>   <span class="n">JOIN_POS</span> <span class="n">HINT</span>
</span><span class='line'><span class="c1">------------------------------ ---------- ---------- ---------- --------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">OL_6</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">1</span> <span class="n">INDEX_RS_ASC</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="ss">&quot;T3&quot;</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span> <span class="p">(</span><span class="ss">&quot;T3&quot;</span><span class="p">.</span><span class="ss">&quot;C2&quot;</span> <span class="ss">&quot;T3&quot;</span><span class="p">.</span><span class="ss">&quot;C3&quot;</span><span class="p">))</span>
</span><span class='line'><span class="n">OL_6</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">OUTLINE_LEAF</span><span class="p">(</span><span class="o">@</span><span class="ss">&quot;SEL$1&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_6</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">ALL_ROWS</span>
</span><span class='line'><span class="n">OL_6</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">DB_VERSION</span><span class="p">(</span><span class="s1">&#39;11.2.0.2&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_6</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">OPTIMIZER_FEATURES_ENABLE</span><span class="p">(</span><span class="s1">&#39;11.2.0.2&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">OL_6</span>                   <span class="mi">1</span>      <span class="mi">1</span>          <span class="mi">0</span> <span class="n">IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'>
</span><span class='line'><span class="mi">6</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>可见，此时的outline中指定了T3_IDX_2</p>

<h1>create outline时，对exits的判断</h1>

<h2>创建具有相同outline name的情况</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="n">outline</span> <span class="n">exist_ol</span> <span class="k">on</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t3</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="n">created</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="n">outline</span> <span class="n">exist_ol</span> <span class="k">on</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t4</span><span class="p">;</span>
</span><span class='line'><span class="k">create</span> <span class="n">outline</span> <span class="n">exist_ol</span> <span class="k">on</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t4</span>
</span><span class='line'>                                         <span class="o">*</span>
</span><span class='line'><span class="n">ERROR</span> <span class="k">at</span> <span class="n">line</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'><span class="n">ORA</span><span class="o">-</span><span class="mi">18004</span><span class="p">:</span> <span class="n">outline</span> <span class="n">already</span> <span class="k">exists</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span> <span class="p">,</span><span class="n">category</span><span class="p">,</span> <span class="n">used</span> <span class="p">,</span><span class="n">sql_text</span> <span class="k">from</span> <span class="n">user_outlines</span> <span class="k">where</span> <span class="n">CATEGORY</span> <span class="o">=</span> <span class="s1">&#39;DEFAULT&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">NAME</span>                  <span class="n">CATEGORY</span>            <span class="n">USED</span>   <span class="n">SQL_TEXT</span>
</span><span class='line'><span class="c1">------------------------------ ------------------------------ ------ --------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">CC</span>                <span class="k">DEFAULT</span>                 <span class="n">UNUSED</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span>
</span><span class='line'><span class="n">C1</span>                <span class="k">DEFAULT</span>                 <span class="n">UNUSED</span> <span class="k">select</span> <span class="cm">/*+ssssss*/</span><span class="o">*</span> <span class="k">from</span> <span class="n">t1</span>
</span><span class='line'><span class="n">EXIST_OL</span>              <span class="k">DEFAULT</span>                 <span class="n">UNUSED</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t3</span>
</span></code></pre></td></tr></table></div></figure>


<p>由此可见在outline name相同，即使语句不同，仍旧无法创建</p>

<h2>outline name 不同，sql语句相同</h2>

<pre><code class="`sql">SQL&gt; create outline exist_ol_1 on select * from t3;
create outline exist_ol_1 on select * from t3
                                           *
ERROR at line 1:
ORA-18004: outline already exists


SQL&gt; select name ,category, used ,sql_text from user_outlines where CATEGORY = 'DEFAULT';

NAME                   CATEGORY               USED   SQL_TEXT
------------------------------ ------------------------------ ------ --------------------------------------------------------------------------------
CC                 DEFAULT                UNUSED select * from t1
C1                 DEFAULT                UNUSED select /*+ssssss*/* from t1
EXIST_OL               DEFAULT                UNUSED select * from t3
</code></pre>

<p> 可见，虽然outline name 不同，但是sql相同的情况下仍旧报错</p>

<h2>outline name不同，sql不同，计划相同的情况</h2>

<pre><code class="`sql"> SQL&gt; create outline exist_ol_1 on select /*+sssss*/* from t3;

Outline created.

SQL&gt; select name ,category, used ,sql_text from user_outlines where CATEGORY = 'DEFAULT';

NAME                   CATEGORY               USED   SQL_TEXT
------------------------------ ------------------------------ ------ --------------------------------------------------------------------------------
CC                 DEFAULT                UNUSED select * from t1
C1                 DEFAULT                UNUSED select /*+ssssss*/* from t1
EXIST_OL               DEFAULT                UNUSED select * from t3
EXIST_OL_1             DEFAULT                UNUSED select /*+sssss*/* from t3
</code></pre>

<p> 可见，在sql中加入无效的hint后，仍旧成功
 ```sql
 SQL> create outline exist_ol_2 on select * from                t3;
create outline exist_ol_2 on select * from        t3
                                                          *
ERROR at line 1:
ORA-18004: outline already exists</p>

<p>SQL> select name ,category, used ,sql_text from user_outlines where CATEGORY = &lsquo;DEFAULT&rsquo;;</p>

<p>NAME                   CATEGORY               USED   SQL_TEXT</p>

<hr />

<p>CC                 DEFAULT                UNUSED select * from t1
C1                 DEFAULT                UNUSED select /<em>+ssssss</em>/<em> from t1
EXIST_OL               DEFAULT                UNUSED select * from t3
EXIST_OL_1             DEFAULT                UNUSED select /</em>+sssss<em>/</em> from t3
 ```
 但是，仅仅是加入无效的空格的话，仍旧无法创建。</p>

<h1>create or replace的表现</h1>

<p>oracle文档中的描述</p>

<blockquote><p>Specify OR REPLACE to replace an existing outline with a new outline of the same name.</p></blockquote>

<h2>使用原来的名字，替换outline</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="n">sql_text</span><span class="p">,</span> <span class="n">category</span> <span class="k">from</span> <span class="n">user_outlines</span> <span class="k">where</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;CC&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">NAME</span>                  <span class="n">SQL_TEXT</span>                                  <span class="n">CATEGORY</span>
</span><span class='line'><span class="c1">------------------------------ -------------------------------------------------------------------------------- ------------------------------</span>
</span><span class='line'><span class="n">CC</span>                <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">,</span><span class="n">t2</span>                                <span class="k">DEFAULT</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">or</span> <span class="k">replace</span> <span class="n">outline</span> <span class="n">cc</span> <span class="k">on</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="n">created</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>可见 ，当outlie_name和sql完全相同时可以成功</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="n">sql_text</span><span class="p">,</span> <span class="n">category</span> <span class="k">from</span> <span class="n">user_outlines</span> <span class="k">where</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;CC&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">NAME</span>                  <span class="n">SQL_TEXT</span>                                  <span class="n">CATEGORY</span>
</span><span class='line'><span class="c1">------------------------------ -------------------------------------------------------------------------------- ------------------------------</span>
</span><span class='line'><span class="n">CC</span>                <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">,</span><span class="n">t2</span>                                <span class="k">DEFAULT</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">or</span> <span class="k">replace</span> <span class="n">outline</span> <span class="n">cc</span> <span class="k">on</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="n">created</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">or</span> <span class="k">replace</span> <span class="n">outline</span> <span class="n">cc</span> <span class="k">on</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="n">created</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>可见 ，当outlie_name相同和sql不同时可以成功，并对原理的sql进行替换。以上这两种，是符合oracle描述的。</p>

<h2>outline name不存在，outline已经存在的情况下</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="n">sql_text</span><span class="p">,</span> <span class="n">category</span> <span class="k">from</span> <span class="n">user_outlines</span> <span class="k">where</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;CC_1&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">NAME</span>                  <span class="n">SQL_TEXT</span>                                  <span class="n">CATEGORY</span>
</span><span class='line'><span class="c1">------------------------------ -------------------------------------------------------------------------------- ------------------------------</span>
</span><span class='line'><span class="n">CC_1</span>                  <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">or</span> <span class="k">replace</span> <span class="n">outline</span> <span class="n">cc</span> <span class="k">on</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="n">created</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="n">sql_text</span><span class="p">,</span> <span class="n">category</span> <span class="k">from</span> <span class="n">user_outlines</span> <span class="k">where</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;CC_1&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">no</span> <span class="k">rows</span> <span class="n">selected</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="n">sql_text</span><span class="p">,</span> <span class="n">category</span> <span class="k">from</span> <span class="n">user_outlines</span> <span class="k">where</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;CC&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">NAME</span>                  <span class="n">SQL_TEXT</span>                                  <span class="n">CATEGORY</span>
</span><span class='line'><span class="c1">------------------------------ -------------------------------------------------------------------------------- ------------------------------</span>
</span><span class='line'><span class="n">CC</span>                <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span>                                 <span class="k">DEFAULT</span>
</span></code></pre></td></tr></table></div></figure>


<p>可见，在对已经存在的sql使用replace时，outline_name会被直接替换掉。</p>

<h1>总结create outline在oracle中的表现</h1>

<ul>
<li>outline是完全按照plan生成的</li>
<li>create outline时忽略无效和错误的hint，并不会给客户端返回错误</li>
<li>生成的outline只会受当前的plan影响，当前指定的hint在未来创建时也不会加入到当前的outline中。</li>
<li>create outlline的重复性，会同时判断outline_name和sql（不是简单的字符串匹配）</li>
<li>create or replace的表现：如果outline name已经存在，sql不同时，则替换sql；如果sql已经存在，outline不同时，则替换outline name</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/06/19/oraclezhong-transformdui-hintde-ying-xiang/">Oracle中transform对hint的影响</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-19T20:56:39+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>8:56 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Oracle中transform对指定hint的影响</h1>

<h2>对index hint的影响</h2>

<h3>没指定hint的情况</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t2</span> <span class="k">where</span> <span class="n">c1</span> <span class="o">&gt;</span> <span class="k">any</span> <span class="p">(</span><span class="k">select</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">T3</span> <span class="k">where</span> <span class="n">c2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">Explained</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span><span class="p">(</span><span class="n">dbms_xplan</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="s1">&#39;PLAN_TABLE&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="s1">&#39;OUTLINE&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Plan</span> <span class="n">hash</span> <span class="n">value</span><span class="p">:</span> <span class="mi">2448468165</span>
</span><span class='line'>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span> <span class="n">Id</span>  <span class="o">|</span> <span class="k">Operation</span>          <span class="o">|</span> <span class="n">Name</span>       <span class="o">|</span> <span class="k">Rows</span>  <span class="o">|</span> <span class="n">Bytes</span> <span class="o">|</span> <span class="n">Cost</span> <span class="p">(</span><span class="o">%</span><span class="n">CPU</span><span class="p">)</span><span class="o">|</span> <span class="n">Time</span>     <span class="o">|</span>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">0</span> <span class="o">|</span> <span class="k">SELECT</span> <span class="k">STATEMENT</span>       <span class="o">|</span>           <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">29</span> <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>  <span class="n">NESTED</span> <span class="n">LOOPS</span> <span class="n">SEMI</span>      <span class="o">|</span>           <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">29</span> <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span>   <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">BY</span> <span class="k">INDEX</span> <span class="n">ROWID</span><span class="o">|</span> <span class="n">T2</span>      <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">26</span> <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">3</span> <span class="o">|</span>    <span class="k">INDEX</span> <span class="n">RANGE</span> <span class="n">SCAN</span>         <span class="o">|</span> <span class="n">SYS_C0012307</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>        <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">4</span> <span class="o">|</span>   <span class="k">INDEX</span> <span class="n">RANGE</span> <span class="n">SCAN</span>      <span class="o">|</span> <span class="n">T3_IDX_1</span>     <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="k">Data</span>
</span><span class='line'><span class="c1">-------------</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*+</span>
</span><span class='line'><span class="cm">      BEGIN_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">      USE_NL(@&quot;SEL$5DA710D3&quot; &quot;T3&quot;@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      LEADING(@&quot;SEL$5DA710D3&quot; &quot;T2&quot;@&quot;SEL$1&quot; &quot;T3&quot;@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      INDEX(@&quot;SEL$5DA710D3&quot; &quot;T3&quot;@&quot;SEL$2&quot; (&quot;T3&quot;.&quot;C2&quot;))</span>
</span><span class='line'><span class="cm">      INDEX_RS_ASC(@&quot;SEL$5DA710D3&quot; &quot;T2&quot;@&quot;SEL$1&quot; (&quot;T2&quot;.&quot;C1&quot;))</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      UNNEST(@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$5DA710D3&quot;)</span>
</span><span class='line'><span class="cm">      ALL_ROWS</span>
</span><span class='line'><span class="cm">      DB_VERSION(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      OPTIMIZER_FEATURES_ENABLE(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'><span class="cm">      END_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>
</span><span class='line'><span class="n">Predicate</span> <span class="n">Information</span> <span class="p">(</span><span class="n">identified</span> <span class="k">by</span> <span class="k">operation</span> <span class="n">id</span><span class="p">):</span>
</span><span class='line'><span class="c1">---------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'>   <span class="mi">3</span> <span class="o">-</span> <span class="k">access</span><span class="p">(</span><span class="ss">&quot;C1&quot;</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>   <span class="mi">4</span> <span class="o">-</span> <span class="k">access</span><span class="p">(</span><span class="ss">&quot;C2&quot;</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>       <span class="n">filter</span><span class="p">(</span><span class="ss">&quot;C1&quot;</span><span class="o">&gt;</span><span class="ss">&quot;C2&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="mi">38</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>可见，在不一定hint的情况下对于t3表的访问，使用了T3_IDX_1索引；同时通过计划可知，消除了子查询生成了semi join。而且，user_nl/leading/index中qb_name都是transform之后的新值.</p>

<h3>按照改写前的query block指定hint</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="cm">/*+index(@&quot;SEL$2&quot; &quot;T3&quot;@&quot;SEL$2&quot; T3_IDX_2)*/</span><span class="o">*</span> <span class="k">from</span> <span class="n">t2</span> <span class="k">where</span> <span class="n">c1</span> <span class="o">&gt;</span> <span class="k">any</span> <span class="p">(</span><span class="k">select</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">T3</span> <span class="k">where</span> <span class="n">c2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">Explained</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span><span class="p">(</span><span class="n">dbms_xplan</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="s1">&#39;PLAN_TABLE&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="s1">&#39;OUTLINE&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Plan</span> <span class="n">hash</span> <span class="n">value</span><span class="p">:</span> <span class="mi">2034984401</span>
</span><span class='line'>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span> <span class="n">Id</span>  <span class="o">|</span> <span class="k">Operation</span>          <span class="o">|</span> <span class="n">Name</span>       <span class="o">|</span> <span class="k">Rows</span>  <span class="o">|</span> <span class="n">Bytes</span> <span class="o">|</span> <span class="n">Cost</span> <span class="p">(</span><span class="o">%</span><span class="n">CPU</span><span class="p">)</span><span class="o">|</span> <span class="n">Time</span>     <span class="o">|</span>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">0</span> <span class="o">|</span> <span class="k">SELECT</span> <span class="k">STATEMENT</span>       <span class="o">|</span>           <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">29</span> <span class="o">|</span>      <span class="mi">1</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>  <span class="n">NESTED</span> <span class="n">LOOPS</span> <span class="n">SEMI</span>      <span class="o">|</span>           <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">29</span> <span class="o">|</span>      <span class="mi">1</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span>   <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">BY</span> <span class="k">INDEX</span> <span class="n">ROWID</span><span class="o">|</span> <span class="n">T2</span>      <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">26</span> <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">3</span> <span class="o">|</span>    <span class="k">INDEX</span> <span class="n">RANGE</span> <span class="n">SCAN</span>         <span class="o">|</span> <span class="n">SYS_C0012307</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>        <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">4</span> <span class="o">|</span>   <span class="k">INDEX</span> <span class="n">RANGE</span> <span class="n">SCAN</span>      <span class="o">|</span> <span class="n">T3_IDX_2</span>     <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">1</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="k">Data</span>
</span><span class='line'><span class="c1">-------------</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*+</span>
</span><span class='line'><span class="cm">      BEGIN_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">      USE_NL(@&quot;SEL$5DA710D3&quot; &quot;T3&quot;@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      LEADING(@&quot;SEL$5DA710D3&quot; &quot;T2&quot;@&quot;SEL$1&quot; &quot;T3&quot;@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      INDEX(@&quot;SEL$5DA710D3&quot; &quot;T3&quot;@&quot;SEL$2&quot; (&quot;T3&quot;.&quot;C2&quot; &quot;T3&quot;.&quot;C3&quot;))</span>
</span><span class='line'><span class="cm">      INDEX_RS_ASC(@&quot;SEL$5DA710D3&quot; &quot;T2&quot;@&quot;SEL$1&quot; (&quot;T2&quot;.&quot;C1&quot;))</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      UNNEST(@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$5DA710D3&quot;)</span>
</span><span class='line'><span class="cm">      ALL_ROWS</span>
</span><span class='line'><span class="cm">      DB_VERSION(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      OPTIMIZER_FEATURES_ENABLE(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'><span class="cm">      END_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>
</span><span class='line'><span class="n">Predicate</span> <span class="n">Information</span> <span class="p">(</span><span class="n">identified</span> <span class="k">by</span> <span class="k">operation</span> <span class="n">id</span><span class="p">):</span>
</span><span class='line'><span class="c1">---------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'>   <span class="mi">3</span> <span class="o">-</span> <span class="k">access</span><span class="p">(</span><span class="ss">&quot;C1&quot;</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>   <span class="mi">4</span> <span class="o">-</span> <span class="k">access</span><span class="p">(</span><span class="ss">&quot;C2&quot;</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>       <span class="n">filter</span><span class="p">(</span><span class="ss">&quot;C1&quot;</span><span class="o">&gt;</span><span class="ss">&quot;C2&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="mi">38</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>hint中，指定的是改写前的qb_name &ldquo;SEL$2"，可见t3使用了T3_IDX_2，hint指定生效。</p>

<h3>hint按照改写后的qb_name指定</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="cm">/*+index(@&quot;SEL$5DA710D3&quot; &quot;T3&quot;@&quot;SEL$5DA710D3&quot; T3_IDX_2)*/</span><span class="o">*</span> <span class="k">from</span> <span class="n">t2</span> <span class="k">where</span> <span class="n">c1</span> <span class="o">&gt;</span> <span class="k">any</span> <span class="p">(</span><span class="k">select</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">T3</span> <span class="k">where</span> <span class="n">c2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">Explained</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span><span class="p">(</span><span class="n">dbms_xplan</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="s1">&#39;PLAN_TABLE&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="s1">&#39;OUTLINE&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Plan</span> <span class="n">hash</span> <span class="n">value</span><span class="p">:</span> <span class="mi">2448468165</span>
</span><span class='line'>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span> <span class="n">Id</span>  <span class="o">|</span> <span class="k">Operation</span>          <span class="o">|</span> <span class="n">Name</span>       <span class="o">|</span> <span class="k">Rows</span>  <span class="o">|</span> <span class="n">Bytes</span> <span class="o">|</span> <span class="n">Cost</span> <span class="p">(</span><span class="o">%</span><span class="n">CPU</span><span class="p">)</span><span class="o">|</span> <span class="n">Time</span>     <span class="o">|</span>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">0</span> <span class="o">|</span> <span class="k">SELECT</span> <span class="k">STATEMENT</span>       <span class="o">|</span>           <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">29</span> <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>  <span class="n">NESTED</span> <span class="n">LOOPS</span> <span class="n">SEMI</span>      <span class="o">|</span>           <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">29</span> <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span>   <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">BY</span> <span class="k">INDEX</span> <span class="n">ROWID</span><span class="o">|</span> <span class="n">T2</span>      <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">26</span> <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">3</span> <span class="o">|</span>    <span class="k">INDEX</span> <span class="n">RANGE</span> <span class="n">SCAN</span>         <span class="o">|</span> <span class="n">SYS_C0012307</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>        <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">4</span> <span class="o">|</span>   <span class="k">INDEX</span> <span class="n">RANGE</span> <span class="n">SCAN</span>      <span class="o">|</span> <span class="n">T3_IDX_1</span>     <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="k">Data</span>
</span><span class='line'><span class="c1">-------------</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*+</span>
</span><span class='line'><span class="cm">      BEGIN_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">      USE_NL(@&quot;SEL$5DA710D3&quot; &quot;T3&quot;@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      LEADING(@&quot;SEL$5DA710D3&quot; &quot;T2&quot;@&quot;SEL$1&quot; &quot;T3&quot;@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      INDEX(@&quot;SEL$5DA710D3&quot; &quot;T3&quot;@&quot;SEL$2&quot; (&quot;T3&quot;.&quot;C2&quot;))</span>
</span><span class='line'><span class="cm">      INDEX_RS_ASC(@&quot;SEL$5DA710D3&quot; &quot;T2&quot;@&quot;SEL$1&quot; (&quot;T2&quot;.&quot;C1&quot;))</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      UNNEST(@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$5DA710D3&quot;)</span>
</span><span class='line'><span class="cm">      ALL_ROWS</span>
</span><span class='line'><span class="cm">      DB_VERSION(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      OPTIMIZER_FEATURES_ENABLE(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'><span class="cm">      END_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>
</span><span class='line'><span class="n">Predicate</span> <span class="n">Information</span> <span class="p">(</span><span class="n">identified</span> <span class="k">by</span> <span class="k">operation</span> <span class="n">id</span><span class="p">):</span>
</span><span class='line'><span class="c1">---------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'>   <span class="mi">3</span> <span class="o">-</span> <span class="k">access</span><span class="p">(</span><span class="ss">&quot;C1&quot;</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>   <span class="mi">4</span> <span class="o">-</span> <span class="k">access</span><span class="p">(</span><span class="ss">&quot;C2&quot;</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>       <span class="n">filter</span><span class="p">(</span><span class="ss">&quot;C1&quot;</span><span class="o">&gt;</span><span class="ss">&quot;C2&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="mi">38</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<h3>总结</h3>

<p>通过对不同位置的qb_name更改，可以生效的形式为:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="cm">/*+index(@&quot;SEL$2&quot; &quot;T3&quot;@&quot;SEL$2&quot; T3_IDX_2)*/</span><span class="o">*</span> <span class="k">from</span> <span class="n">t2</span> <span class="k">where</span> <span class="n">c1</span> <span class="o">&gt;</span> <span class="k">any</span> <span class="p">(</span><span class="k">select</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">T3</span> <span class="k">where</span> <span class="n">c2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="cm">/*+index(@&quot;SEL$5DA710D3&quot; &quot;T3&quot;@&quot;SEL$2&quot; T3_IDX_2)*/</span><span class="o">*</span> <span class="k">from</span> <span class="n">t2</span> <span class="k">where</span> <span class="n">c1</span> <span class="o">&gt;</span> <span class="k">any</span> <span class="p">(</span><span class="k">select</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">T3</span> <span class="k">where</span> <span class="n">c2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>无效的qb_name指定形式为：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="cm">/*+index(@&quot;SEL$1&quot; &quot;T3&quot;@&quot;SEL$2&quot; T3_IDX_2)*/</span><span class="o">*</span> <span class="k">from</span> <span class="n">t2</span> <span class="k">where</span> <span class="n">c1</span> <span class="o">&gt;</span> <span class="k">any</span> <span class="p">(</span><span class="k">select</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">T3</span> <span class="k">where</span> <span class="n">c2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="cm">/*+index(@&quot;SEL$5DA710D3&quot; &quot;T3&quot;@&quot;SEL$5DA710D3&quot; T3_IDX_2)*/</span><span class="o">*</span> <span class="k">from</span> <span class="n">t2</span> <span class="k">where</span> <span class="n">c1</span> <span class="o">&gt;</span> <span class="k">any</span> <span class="p">(</span><span class="k">select</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">T3</span> <span class="k">where</span> <span class="n">c2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>结论：在index hint面对transform时，如果想生效，需要满足两个条件：
1. table后面的qb_name必须是transform之前的qb_name
2. 整个index所指定的qb_name可以是改写之前的(本例中：SEL\$2)，也可以是改写之后由系统生成的(本例中：SEL\$5DA710D3)，但不可以是改写前外层的(本例中：SEL\$1)</p>

<h2>对leading hint的影响</h2>

<h3>没指定hint的情况</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span> <span class="k">where</span> <span class="n">c1</span> <span class="o">&gt;</span> <span class="k">any</span> <span class="p">(</span><span class="k">select</span> <span class="n">c2</span> <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">t2</span><span class="p">.</span><span class="n">c2</span><span class="p">)</span> <span class="k">from</span> <span class="n">t2</span><span class="p">,</span><span class="n">t3</span> <span class="k">group</span> <span class="k">by</span> <span class="n">t2</span><span class="p">.</span><span class="n">c1</span><span class="p">)</span> <span class="n">tt</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">Explained</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span><span class="p">(</span><span class="n">dbms_xplan</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="s1">&#39;PLAN_TABLE&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="s1">&#39;OUTLINE&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Plan</span> <span class="n">hash</span> <span class="n">value</span><span class="p">:</span> <span class="mi">3676677615</span>
</span><span class='line'>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span> <span class="n">Id</span>  <span class="o">|</span> <span class="k">Operation</span>     <span class="o">|</span> <span class="n">Name</span>           <span class="o">|</span> <span class="k">Rows</span>  <span class="o">|</span> <span class="n">Bytes</span> <span class="o">|</span> <span class="n">Cost</span> <span class="p">(</span><span class="o">%</span><span class="n">CPU</span><span class="p">)</span><span class="o">|</span> <span class="n">Time</span>     <span class="o">|</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">0</span> <span class="o">|</span> <span class="k">SELECT</span> <span class="k">STATEMENT</span>  <span class="o">|</span>           <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">26</span> <span class="o">|</span>     <span class="mi">5</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">1</span> <span class="o">|</span>  <span class="n">FILTER</span>      <span class="o">|</span>           <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>           <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span>   <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span>    <span class="o">|</span> <span class="n">T1</span>         <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">26</span> <span class="o">|</span>     <span class="mi">2</span>  <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">3</span> <span class="o">|</span>   <span class="n">FILTER</span>     <span class="o">|</span>           <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>           <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">4</span> <span class="o">|</span>    <span class="n">HASH</span> <span class="k">GROUP</span> <span class="k">BY</span>   <span class="o">|</span>           <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">3</span> <span class="p">(</span><span class="mi">34</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">5</span> <span class="o">|</span>     <span class="n">MERGE</span> <span class="k">JOIN</span> <span class="n">CARTESIAN</span><span class="o">|</span>          <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">2</span>  <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">6</span> <span class="o">|</span>      <span class="k">INDEX</span> <span class="k">FULL</span> <span class="n">SCAN</span>   <span class="o">|</span> <span class="n">SYS_C0012307</span> <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">0</span>    <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">7</span> <span class="o">|</span>      <span class="n">BUFFER</span> <span class="n">SORT</span>  <span class="o">|</span>           <span class="o">|</span>     <span class="mi">3</span> <span class="o">|</span>       <span class="o">|</span>     <span class="mi">3</span> <span class="p">(</span><span class="mi">34</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">8</span> <span class="o">|</span>       <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span> <span class="o">|</span> <span class="n">T3</span>        <span class="o">|</span>     <span class="mi">3</span> <span class="o">|</span>       <span class="o">|</span>     <span class="mi">2</span>  <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="k">Data</span>
</span><span class='line'><span class="c1">-------------</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*+</span>
</span><span class='line'><span class="cm">      BEGIN_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">      USE_HASH_AGGREGATION(@&quot;SEL$335DD26A&quot;)</span>
</span><span class='line'><span class="cm">      USE_MERGE_CARTESIAN(@&quot;SEL$335DD26A&quot; &quot;T3&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      LEADING(@&quot;SEL$335DD26A&quot; &quot;T2&quot;@&quot;SEL$3&quot; &quot;T3&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$335DD26A&quot; &quot;T3&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      INDEX(@&quot;SEL$335DD26A&quot; &quot;T2&quot;@&quot;SEL$3&quot; (&quot;T2&quot;.&quot;C1&quot;))</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$1&quot; &quot;T1&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      MERGE(@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$335DD26A&quot;)</span>
</span><span class='line'><span class="cm">      ALL_ROWS</span>
</span><span class='line'><span class="cm">      DB_VERSION(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      OPTIMIZER_FEATURES_ENABLE(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'><span class="cm">      END_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>
</span><span class='line'><span class="n">Predicate</span> <span class="n">Information</span> <span class="p">(</span><span class="n">identified</span> <span class="k">by</span> <span class="k">operation</span> <span class="n">id</span><span class="p">):</span>
</span><span class='line'><span class="c1">---------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'>   <span class="mi">1</span> <span class="o">-</span> <span class="n">filter</span><span class="p">(</span> <span class="k">EXISTS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="mi">0</span> <span class="k">FROM</span> <span class="ss">&quot;T3&quot;</span> <span class="ss">&quot;T3&quot;</span><span class="p">,</span><span class="ss">&quot;T2&quot;</span> <span class="ss">&quot;T2&quot;</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;T2&quot;</span><span class="p">.</span><span class="ss">&quot;C1&quot;</span><span class="p">,:</span><span class="n">B1</span>
</span><span class='line'>        <span class="k">HAVING</span> <span class="p">:</span><span class="n">B2</span><span class="o">&gt;</span><span class="p">:</span><span class="n">B3</span><span class="p">))</span>
</span><span class='line'>   <span class="mi">3</span> <span class="o">-</span> <span class="n">filter</span><span class="p">(:</span><span class="n">B1</span><span class="o">&gt;</span><span class="p">:</span><span class="n">B2</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="mi">45</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>由outline的内容可知，在没有指定hint的情况下，join的顺序为t2,t3</p>

<h3>对leading指定改写前的qb_name</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="cm">/*+LEADING(@&quot;SEL$3&quot; &quot;T3&quot;@&quot;SEL$3&quot; &quot;T2&quot;@&quot;SEL$3&quot;)*/</span><span class="o">*</span> <span class="k">from</span> <span class="n">t1</span> <span class="k">where</span> <span class="n">c1</span> <span class="o">&gt;</span> <span class="k">any</span> <span class="p">(</span><span class="k">select</span> <span class="n">c2</span> <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">t2</span><span class="p">.</span><span class="n">c2</span><span class="p">)</span> <span class="k">from</span> <span class="n">t2</span><span class="p">,</span><span class="n">t3</span> <span class="k">group</span> <span class="k">by</span> <span class="n">t2</span><span class="p">.</span><span class="n">c1</span><span class="p">)</span> <span class="n">tt</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">Explained</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span><span class="p">(</span><span class="n">dbms_xplan</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="s1">&#39;PLAN_TABLE&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="s1">&#39;OUTLINE&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Plan</span> <span class="n">hash</span> <span class="n">value</span><span class="p">:</span> <span class="mi">3161554821</span>
</span><span class='line'>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span> <span class="n">Id</span>  <span class="o">|</span> <span class="k">Operation</span>     <span class="o">|</span> <span class="n">Name</span>           <span class="o">|</span> <span class="k">Rows</span>  <span class="o">|</span> <span class="n">Bytes</span> <span class="o">|</span> <span class="n">Cost</span> <span class="p">(</span><span class="o">%</span><span class="n">CPU</span><span class="p">)</span><span class="o">|</span> <span class="n">Time</span>     <span class="o">|</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">0</span> <span class="o">|</span> <span class="k">SELECT</span> <span class="k">STATEMENT</span>  <span class="o">|</span>           <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">26</span> <span class="o">|</span>     <span class="mi">5</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">1</span> <span class="o">|</span>  <span class="n">FILTER</span>      <span class="o">|</span>           <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>           <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span>   <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span>    <span class="o">|</span> <span class="n">T1</span>         <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">26</span> <span class="o">|</span>     <span class="mi">2</span>  <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">3</span> <span class="o">|</span>   <span class="n">FILTER</span>     <span class="o">|</span>           <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>           <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">4</span> <span class="o">|</span>    <span class="n">HASH</span> <span class="k">GROUP</span> <span class="k">BY</span>   <span class="o">|</span>           <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">3</span> <span class="p">(</span><span class="mi">34</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">5</span> <span class="o">|</span>     <span class="n">MERGE</span> <span class="k">JOIN</span> <span class="n">CARTESIAN</span><span class="o">|</span>          <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">2</span>  <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">6</span> <span class="o">|</span>      <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span> <span class="o">|</span> <span class="n">T3</span>         <span class="o">|</span>     <span class="mi">3</span> <span class="o">|</span>       <span class="o">|</span>     <span class="mi">2</span>  <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">7</span> <span class="o">|</span>      <span class="n">BUFFER</span> <span class="n">SORT</span>  <span class="o">|</span>           <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">1</span> <span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">8</span> <span class="o">|</span>       <span class="k">INDEX</span> <span class="k">FULL</span> <span class="n">SCAN</span>  <span class="o">|</span> <span class="n">SYS_C0012307</span> <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">0</span>    <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="k">Data</span>
</span><span class='line'><span class="c1">-------------</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*+</span>
</span><span class='line'><span class="cm">      BEGIN_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">      USE_HASH_AGGREGATION(@&quot;SEL$335DD26A&quot;)</span>
</span><span class='line'><span class="cm">      USE_MERGE_CARTESIAN(@&quot;SEL$335DD26A&quot; &quot;T2&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      LEADING(@&quot;SEL$335DD26A&quot; &quot;T3&quot;@&quot;SEL$3&quot; &quot;T2&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      INDEX(@&quot;SEL$335DD26A&quot; &quot;T2&quot;@&quot;SEL$3&quot; (&quot;T2&quot;.&quot;C1&quot;))</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$335DD26A&quot; &quot;T3&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$1&quot; &quot;T1&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      MERGE(@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$335DD26A&quot;)</span>
</span><span class='line'><span class="cm">      ALL_ROWS</span>
</span><span class='line'><span class="cm">      DB_VERSION(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      OPTIMIZER_FEATURES_ENABLE(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'><span class="cm">      END_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>
</span><span class='line'><span class="n">Predicate</span> <span class="n">Information</span> <span class="p">(</span><span class="n">identified</span> <span class="k">by</span> <span class="k">operation</span> <span class="n">id</span><span class="p">):</span>
</span><span class='line'><span class="c1">---------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'>   <span class="mi">1</span> <span class="o">-</span> <span class="n">filter</span><span class="p">(</span> <span class="k">EXISTS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="cm">/*+ LEADING (&quot;T3&quot; &quot;T2&quot;) */</span> <span class="mi">0</span> <span class="k">FROM</span> <span class="ss">&quot;T3&quot;</span> <span class="ss">&quot;T3&quot;</span><span class="p">,</span><span class="ss">&quot;T2&quot;</span>
</span><span class='line'>        <span class="ss">&quot;T2&quot;</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;T2&quot;</span><span class="p">.</span><span class="ss">&quot;C1&quot;</span><span class="p">,:</span><span class="n">B1</span> <span class="k">HAVING</span> <span class="p">:</span><span class="n">B2</span><span class="o">&gt;</span><span class="p">:</span><span class="n">B3</span><span class="p">))</span>
</span><span class='line'>   <span class="mi">3</span> <span class="o">-</span> <span class="n">filter</span><span class="p">(:</span><span class="n">B1</span><span class="o">&gt;</span><span class="p">:</span><span class="n">B2</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="mi">45</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>可见当指定/*+LEADING(@&ldquo;SEL$3&rdquo; &ldquo;T3&rdquo;@&ldquo;SEL$3&rdquo; &ldquo;T2&rdquo;@&ldquo;SEL$3&rdquo;)*/时，hint生效，join的顺序变为t3,t2</p>

<h3>对leading指定改写后的qb_name</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="cm">/*+LEADING(@&quot;SEL$335DD26A&quot; &quot;T3&quot;@&quot;SEL$3&quot; &quot;T2&quot;@&quot;SEL$3&quot;)*/</span><span class="o">*</span> <span class="k">from</span> <span class="n">t1</span> <span class="k">where</span> <span class="n">c1</span> <span class="o">&gt;</span> <span class="k">any</span> <span class="p">(</span><span class="k">select</span> <span class="n">c2</span> <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">t2</span><span class="p">.</span><span class="n">c2</span><span class="p">)</span> <span class="k">from</span> <span class="n">t2</span><span class="p">,</span><span class="n">t3</span> <span class="k">group</span> <span class="k">by</span> <span class="n">t2</span><span class="p">.</span><span class="n">c1</span><span class="p">)</span> <span class="n">tt</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">Explained</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span><span class="p">(</span><span class="n">dbms_xplan</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="s1">&#39;PLAN_TABLE&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="s1">&#39;OUTLINE&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Plan</span> <span class="n">hash</span> <span class="n">value</span><span class="p">:</span> <span class="mi">3161554821</span>
</span><span class='line'>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span> <span class="n">Id</span>  <span class="o">|</span> <span class="k">Operation</span>     <span class="o">|</span> <span class="n">Name</span>           <span class="o">|</span> <span class="k">Rows</span>  <span class="o">|</span> <span class="n">Bytes</span> <span class="o">|</span> <span class="n">Cost</span> <span class="p">(</span><span class="o">%</span><span class="n">CPU</span><span class="p">)</span><span class="o">|</span> <span class="n">Time</span>     <span class="o">|</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">0</span> <span class="o">|</span> <span class="k">SELECT</span> <span class="k">STATEMENT</span>  <span class="o">|</span>           <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">26</span> <span class="o">|</span>     <span class="mi">5</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">1</span> <span class="o">|</span>  <span class="n">FILTER</span>      <span class="o">|</span>           <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>           <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span>   <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span>    <span class="o">|</span> <span class="n">T1</span>         <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">26</span> <span class="o">|</span>     <span class="mi">2</span>  <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">3</span> <span class="o">|</span>   <span class="n">FILTER</span>     <span class="o">|</span>           <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>           <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">4</span> <span class="o">|</span>    <span class="n">HASH</span> <span class="k">GROUP</span> <span class="k">BY</span>   <span class="o">|</span>           <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">3</span> <span class="p">(</span><span class="mi">34</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">5</span> <span class="o">|</span>     <span class="n">MERGE</span> <span class="k">JOIN</span> <span class="n">CARTESIAN</span><span class="o">|</span>          <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">2</span>  <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">6</span> <span class="o">|</span>      <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span> <span class="o">|</span> <span class="n">T3</span>         <span class="o">|</span>     <span class="mi">3</span> <span class="o">|</span>       <span class="o">|</span>     <span class="mi">2</span>  <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">7</span> <span class="o">|</span>      <span class="n">BUFFER</span> <span class="n">SORT</span>  <span class="o">|</span>           <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">1</span> <span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">8</span> <span class="o">|</span>       <span class="k">INDEX</span> <span class="k">FULL</span> <span class="n">SCAN</span>  <span class="o">|</span> <span class="n">SYS_C0012307</span> <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">0</span>    <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="k">Data</span>
</span><span class='line'><span class="c1">-------------</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*+</span>
</span><span class='line'><span class="cm">      BEGIN_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">      USE_HASH_AGGREGATION(@&quot;SEL$335DD26A&quot;)</span>
</span><span class='line'><span class="cm">      USE_MERGE_CARTESIAN(@&quot;SEL$335DD26A&quot; &quot;T2&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      LEADING(@&quot;SEL$335DD26A&quot; &quot;T3&quot;@&quot;SEL$3&quot; &quot;T2&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      INDEX(@&quot;SEL$335DD26A&quot; &quot;T2&quot;@&quot;SEL$3&quot; (&quot;T2&quot;.&quot;C1&quot;))</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$335DD26A&quot; &quot;T3&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$1&quot; &quot;T1&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      MERGE(@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$335DD26A&quot;)</span>
</span><span class='line'><span class="cm">      ALL_ROWS</span>
</span><span class='line'><span class="cm">      DB_VERSION(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      OPTIMIZER_FEATURES_ENABLE(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'><span class="cm">      END_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>
</span><span class='line'><span class="n">Predicate</span> <span class="n">Information</span> <span class="p">(</span><span class="n">identified</span> <span class="k">by</span> <span class="k">operation</span> <span class="n">id</span><span class="p">):</span>
</span><span class='line'><span class="c1">---------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'>   <span class="mi">1</span> <span class="o">-</span> <span class="n">filter</span><span class="p">(</span> <span class="k">EXISTS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="cm">/*+ LEADING (&quot;T3&quot; &quot;T2&quot;) */</span> <span class="mi">0</span> <span class="k">FROM</span> <span class="ss">&quot;T3&quot;</span> <span class="ss">&quot;T3&quot;</span><span class="p">,</span><span class="ss">&quot;T2&quot;</span>
</span><span class='line'>        <span class="ss">&quot;T2&quot;</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;T2&quot;</span><span class="p">.</span><span class="ss">&quot;C1&quot;</span><span class="p">,:</span><span class="n">B1</span> <span class="k">HAVING</span> <span class="p">:</span><span class="n">B2</span><span class="o">&gt;</span><span class="p">:</span><span class="n">B3</span><span class="p">))</span>
</span><span class='line'>   <span class="mi">3</span> <span class="o">-</span> <span class="n">filter</span><span class="p">(:</span><span class="n">B1</span><span class="o">&gt;</span><span class="p">:</span><span class="n">B2</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="mi">45</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>可见当指定/*+LEADING(@&ldquo;SEL$335DD26A&rdquo; &ldquo;T3&rdquo;@&ldquo;SEL$3&rdquo; &ldquo;T2&rdquo;@&ldquo;SEL$3&rdquo;)*/时，hint生效，join的顺序变为t3,t2</p>

<h3>对leading指定改写前上层的qb_name</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span><span class="p">(</span><span class="n">dbms_xplan</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="s1">&#39;PLAN_TABLE&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="s1">&#39;OUTLINE&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Plan</span> <span class="n">hash</span> <span class="n">value</span><span class="p">:</span> <span class="mi">3676677615</span>
</span><span class='line'>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span> <span class="n">Id</span>  <span class="o">|</span> <span class="k">Operation</span>     <span class="o">|</span> <span class="n">Name</span>           <span class="o">|</span> <span class="k">Rows</span>  <span class="o">|</span> <span class="n">Bytes</span> <span class="o">|</span> <span class="n">Cost</span> <span class="p">(</span><span class="o">%</span><span class="n">CPU</span><span class="p">)</span><span class="o">|</span> <span class="n">Time</span>     <span class="o">|</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">0</span> <span class="o">|</span> <span class="k">SELECT</span> <span class="k">STATEMENT</span>  <span class="o">|</span>           <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">26</span> <span class="o">|</span>     <span class="mi">5</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">1</span> <span class="o">|</span>  <span class="n">FILTER</span>      <span class="o">|</span>           <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>           <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span>   <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span>    <span class="o">|</span> <span class="n">T1</span>         <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">26</span> <span class="o">|</span>     <span class="mi">2</span>  <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">3</span> <span class="o">|</span>   <span class="n">FILTER</span>     <span class="o">|</span>           <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>           <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">4</span> <span class="o">|</span>    <span class="n">HASH</span> <span class="k">GROUP</span> <span class="k">BY</span>   <span class="o">|</span>           <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">3</span> <span class="p">(</span><span class="mi">34</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">5</span> <span class="o">|</span>     <span class="n">MERGE</span> <span class="k">JOIN</span> <span class="n">CARTESIAN</span><span class="o">|</span>          <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">2</span>  <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">6</span> <span class="o">|</span>      <span class="k">INDEX</span> <span class="k">FULL</span> <span class="n">SCAN</span>   <span class="o">|</span> <span class="n">SYS_C0012307</span> <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">0</span>    <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">7</span> <span class="o">|</span>      <span class="n">BUFFER</span> <span class="n">SORT</span>  <span class="o">|</span>           <span class="o">|</span>     <span class="mi">3</span> <span class="o">|</span>       <span class="o">|</span>     <span class="mi">3</span> <span class="p">(</span><span class="mi">34</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">8</span> <span class="o">|</span>       <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span> <span class="o">|</span> <span class="n">T3</span>        <span class="o">|</span>     <span class="mi">3</span> <span class="o">|</span>       <span class="o">|</span>     <span class="mi">2</span>  <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="k">Data</span>
</span><span class='line'><span class="c1">-------------</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*+</span>
</span><span class='line'><span class="cm">      BEGIN_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">      USE_HASH_AGGREGATION(@&quot;SEL$335DD26A&quot;)</span>
</span><span class='line'><span class="cm">      USE_MERGE_CARTESIAN(@&quot;SEL$335DD26A&quot; &quot;T3&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      LEADING(@&quot;SEL$335DD26A&quot; &quot;T2&quot;@&quot;SEL$3&quot; &quot;T3&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$335DD26A&quot; &quot;T3&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      INDEX(@&quot;SEL$335DD26A&quot; &quot;T2&quot;@&quot;SEL$3&quot; (&quot;T2&quot;.&quot;C1&quot;))</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$1&quot; &quot;T1&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      MERGE(@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$335DD26A&quot;)</span>
</span><span class='line'><span class="cm">      ALL_ROWS</span>
</span><span class='line'><span class="cm">      DB_VERSION(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      OPTIMIZER_FEATURES_ENABLE(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'><span class="cm">      END_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>
</span><span class='line'><span class="n">Predicate</span> <span class="n">Information</span> <span class="p">(</span><span class="n">identified</span> <span class="k">by</span> <span class="k">operation</span> <span class="n">id</span><span class="p">):</span>
</span><span class='line'><span class="c1">---------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'>   <span class="mi">1</span> <span class="o">-</span> <span class="n">filter</span><span class="p">(</span> <span class="k">EXISTS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="mi">0</span> <span class="k">FROM</span> <span class="ss">&quot;T3&quot;</span> <span class="ss">&quot;T3&quot;</span><span class="p">,</span><span class="ss">&quot;T2&quot;</span> <span class="ss">&quot;T2&quot;</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;T2&quot;</span><span class="p">.</span><span class="ss">&quot;C1&quot;</span><span class="p">,:</span><span class="n">B1</span>
</span><span class='line'>        <span class="k">HAVING</span> <span class="p">:</span><span class="n">B2</span><span class="o">&gt;</span><span class="p">:</span><span class="n">B3</span><span class="p">))</span>
</span><span class='line'>   <span class="mi">3</span> <span class="o">-</span> <span class="n">filter</span><span class="p">(:</span><span class="n">B1</span><span class="o">&gt;</span><span class="p">:</span><span class="n">B2</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="mi">45</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>可见当指定/*+LEADING(@&ldquo;SEL\$1 "T3&rdquo;@&ldquo;SEL\$3&rdquo; &ldquo;T2&rdquo;@&ldquo;SEL\$3&rdquo;)*/时，hint无效，join的顺序仍旧为t2,t3</p>

<h3>总结</h3>

<p>对于在hint中指定leading时，要想使hint生效需要保证：qb_name可以是改写之前的（本例中：SEL\$3），也可以是改写之后由系统生成的(本例中：SEL\$335DD26A)，但不可以是改写前外层的(本例中：SEL\$1)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/06/04/gdbchang-yong-ming-ling/">Gdbchang Yong Ming Ling</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-04T00:00:00+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><pre><code>⁃ ---
</code></pre>

<p>layout: post
title: &ldquo;GDB常用命令&rdquo;
date: 2016-06-04 19:32:28 +0800
comments: true</p>

<h2>categories: GDB</h2>

<h1>GDB输出相关</h1>

<h2>打印格式指定</h2>

<blockquote><p>print / \&lt;f> \&lt;expr></p></blockquote>

<h2>输出基类执行绑定的动态类型</h2>

<blockquote><p>set print object on
p ptr</p></blockquote>

<h2>输出内存形式</h2>

<blockquote><p>x / nfu addr</p></blockquote>

<h2>以数组形式打印内存</h2>

<blockquote><p>p *array@len
p/x (short[2])0x12345678</p></blockquote>

<h2>将gdb内容输出到文件中</h2>

<blockquote><p>set logging file \ <file name>
set logging on
some command
set logging off</p></blockquote>

<p>在需要输出大量gdb信息时特别有效，例如：输出当前所有thread堆栈信息到一个文件中，然后这些堆栈信息进行分析</p>

<h1>Thread相关内容</h1>

<h2>对所有thread使用相同的commond</h2>

<blockquote><p>thread apply all \<command></p></blockquote>

<h2>为指定thread加入断点</h2>

<blockquote><p>break location thread thread-id
break location thread thread-id</p></blockquote>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/05/29/zheng-ze-biao-da-shi/">正则表达式</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-29T22:58:24+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>10:58 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>匹配行头：^
匹配行尾：$</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/05/29/emacschang-yong-ming-ling/">Emacs常用命令</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-29T21:52:31+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:52 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>搜索与查找</h1>

<p>正则查找：C-M-s C-M-r</p>

<p>普通查找：C-S C-r</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/05/15/ao-man-yu-pian-jian/">Pride and Prejudice</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-15T20:38:11+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>8:38 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>简介</h1>

<p>Pride and Prejudice(中文:傲慢与偏见)，是英国小说家简·奥斯丁的代表作，主要讲述了班纳特家两个姐妹的爱情故事，反映了19世纪英国乡绅阶层的生活、民俗、爱情等。</p>

<h1>回味</h1>

<h2>书名</h2>

<p>刚开始阅读这部小说时，觉得这个书名很奇怪，通过书名无法体味到要表达怎样的一种情愫。但是随着阅读的深入，慢慢体会到这两个词贯穿了整个故事情节。“傲慢”毋庸置疑是对达西的评价，他是个富有的绅士，是一个大地主，是小说中描述的上层阶级，从小被教育要看不起除家里以外的任何人；但是，当爱情到来时，他察觉到了自己的傲慢，也用于放下自己的傲慢，哪怕是对哪些可能会影响其名誉的人仍旧如此。“偏见”指的是小说中的另一位主人公——伊丽莎白，她聪明伶俐，美丽大方，被所有人所喜爱，是的傲慢的达西一见钟情；然后，恰恰是她的“聪明”使他对很对事情有着自以为正确的偏见。当达西与伊丽莎白相遇后，这种傲慢与偏见的态度有都纷纷表现在对对方的态度上。好在故事的最后，主人公们为了爱情突破一道道屏障，最后走到了一起，从此过上了幸福快乐的生活。</p>

<h2>现实生活中的傲慢与偏见</h2>

<p>在阅读小说的过程中发现，日常中的我们不也是充满着傲慢与偏见吗？对于不如我们的人，我们是不是会存在着一种傲慢的心里对待他们，我想大多数的或多或少有一些的；对于做事风格与我们不符的人，我们又会不会对其有所偏见的，这个应该也是逃不过的。小说中，与达西和伊丽莎白产生明显对比的是另一对主人公：彬格莱和吉英。彬格莱先生性格温和、为人体贴；吉英美丽善良、温柔体贴、善解人意。生活中，如果能做到像他们一样，一定可以少许多的怨气，生活也会快乐些。世界上没有完美的人，许多我们所不喜欢的人往往都是由于自己的傲慢与偏见造成的，努力放弃这些，去捡拾每个人身上的优点，这样世界会更加美好。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/05/15/use-oracle-explain/">Use Oracle Explain</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-15T20:08:21+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>8:08 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>生成explain</h3>

<pre><code>SQL&gt; explain plan into plan_table for  select /*+index(test testi) */ * from t1;

Explained.
</code></pre>

<h3>查看含有outline的explain</h3>

<pre><code>SQL&gt; select * from table(dbms_xplan.display('PLAN_TABLE',NULL,'OUTLINE'));

PLAN_TABLE_OUTPUT
--------------------------------------------------------------------------------
Plan hash value: 3617692013

--------------------------------------------------------------------------
| Id  | Operation     | Name | Rows  | Bytes | Cost (%CPU)| Time     |
--------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |  |     1 |    13 |     2   (0)| 00:00:01 |
|   1 |  TABLE ACCESS FULL| T1    |     1 |    13 |     2   (0)| 00:00:01 |
--------------------------------------------------------------------------

Outline Data
-------------

PLAN_TABLE_OUTPUT
--------------------------------------------------------------------------------

  /*+
        BEGIN_OUTLINE_DATA
        FULL(@"SEL$1" "T1"@"SEL$1")
        OUTLINE_LEAF(@"SEL$1")
        ALL_ROWS
        DB_VERSION('11.2.0.2')
        OPTIMIZER_FEATURES_ENABLE('11.2.0.2')
        IGNORE_OPTIM_EMBEDDED_HINTS
        END_OUTLINE_DATA
   */

PLAN_TABLE_OUTPUT
--------------------------------------------------------------------------------

Note
-----
   - dynamic sampling used for this statement (level=2)

26 rows selected.
</code></pre>

<h3>index 的表现</h3>

<pre><code>    SQL&gt; select * from table(dbms_xplan.display('plan_table',NULL,'OUTLINE'));

    PLAN_TABLE_OUTPUT
    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    Plan hash value: 2965991605

    ---------------------------------------------------------------------------------
    | Id  | Operation    | Name     | Rows  | Bytes | Cost (%CPU)| Time |
    ---------------------------------------------------------------------------------
    |   0 | SELECT STATEMENT |      |     1 |    13 |     0   (0)| 00:00:01 |
    |   1 |  INDEX FULL SCAN | SYS_C0011876 |     1 |    13 |     0   (0)| 00:00:01 |
    ---------------------------------------------------------------------------------

    Outline Data
    -------------

    PLAN_TABLE_OUTPUT
    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

      /*+
          BEGIN_OUTLINE_DATA
          INDEX(@"SEL$1" "T1"@"SEL$1" ("T1"."C1"))
          OUTLINE_LEAF(@"SEL$1")
          ALL_ROWS
          DB_VERSION('11.2.0.2')
          OPTIMIZER_FEATURES_ENABLE('11.2.0.2')
          IGNORE_OPTIM_EMBEDDED_HINTS
          END_OUTLINE_DATA
      */

    22 rows selected.
</code></pre>

<p>IOT表的表现
    SQL> select * from     table(dbms_xplan.display(&lsquo;plan_table&rsquo;,NULL,&lsquo;OUTLINE&rsquo;));</p>

<pre><code>    PLAN_TABLE_OUTPUT
    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    Plan hash value: 900014233

    ------------------------------------------------------------------------------------------
    | Id  | Operation        | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
    ------------------------------------------------------------------------------------------
    |   0 | SELECT STATEMENT     |           |     1 |  1050 |   802   (0)| 00:00:10 |
    |   1 |  INDEX FAST FULL SCAN| PK_ADMIN_DOCINDEX |     1 |  1050 |   802   (0)| 00:00:10 |
    ------------------------------------------------------------------------------------------

    Outline Data
    -------------

    PLAN_TABLE_OUTPUT
    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

      /*+
          BEGIN_OUTLINE_DATA
          INDEX_FFS(@"SEL$1" "ADMIN_DOCINDEX"@"SEL$1" ("ADMIN_DOCINDEX"."TOKEN"
              "ADMIN_DOCINDEX"."DOC_ID"))
          OUTLINE_LEAF(@"SEL$1")
          ALL_ROWS
          DB_VERSION('11.2.0.2')
          OPTIMIZER_FEATURES_ENABLE('11.2.0.2')
          IGNORE_OPTIM_EMBEDDED_HINTS
          END_OUTLINE_DATA

    PLAN_TABLE_OUTPUT
    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      */

    Note
    -----
       - dynamic sampling used for this statement (level=2)

    27 rows selected.
</code></pre>

<h3>涉及到rewrite时，hint中的qb_name</h3>

<pre><code>    SQL&gt; select * from table(dbms_xplan.display('plan_table',NULL,'OUTLINE'));

    PLAN_TABLE_OUTPUT
    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    Plan hash value: 1463220175

    -------------------------------------------------------------------------------------
    | Id  | Operation        | Name     | Rows  | Bytes | Cost (%CPU)| Time     |
    -------------------------------------------------------------------------------------
    |   0 | SELECT STATEMENT     |          |     1 |    13 |     0   (0)| 00:00:01 |
    |   1 |  MERGE JOIN CARTESIAN|          |     1 |    13 |     0   (0)| 00:00:01 |
    |   2 |   INDEX FULL SCAN    | SYS_C0011876 |     1 |    13 |     0   (0)| 00:00:01 |
    |   3 |   BUFFER SORT        |          |     1 |       |     0   (0)| 00:00:01 |
    |   4 |    INDEX FULL SCAN   | SYS_C0011877 |     1 |       |     0   (0)| 00:00:01 |
    -------------------------------------------------------------------------------------

    PLAN_TABLE_OUTPUT
    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Outline Data
    -------------

      /*+
          BEGIN_OUTLINE_DATA
          USE_MERGE_CARTESIAN(@"SEL$F5BB74E1" "T2"@"SEL$2")
          LEADING(@"SEL$F5BB74E1" "T1"@"SEL$2" "T2"@"SEL$2")
          INDEX(@"SEL$F5BB74E1" "T2"@"SEL$2" ("T2"."C2"))
          INDEX(@"SEL$F5BB74E1" "T1"@"SEL$2" ("T1"."C1"))
          OUTLINE(@"SEL$2")

    PLAN_TABLE_OUTPUT
    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
          OUTLINE(@"SEL$1")
          MERGE(@"SEL$2")
          OUTLINE_LEAF(@"SEL$F5BB74E1")
          ALL_ROWS
          DB_VERSION('11.2.0.2')
          OPTIMIZER_FEATURES_ENABLE('11.2.0.2')
          IGNORE_OPTIM_EMBEDDED_HINTS
          END_OUTLINE_DATA
      */

    31 rows selected.
</code></pre>

<h3>多表join的情况</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">t3</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Explained</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span><span class="p">(</span><span class="n">dbms_xplan</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="s1">&#39;plan_table&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="s1">&#39;OUTLINE&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Plan</span> <span class="n">hash</span> <span class="n">value</span><span class="p">:</span> <span class="mi">457197764</span>
</span><span class='line'>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span> <span class="n">Id</span>  <span class="o">|</span> <span class="k">Operation</span>       <span class="o">|</span> <span class="n">Name</span>       <span class="o">|</span> <span class="k">Rows</span>  <span class="o">|</span> <span class="n">Bytes</span> <span class="o">|</span> <span class="n">Cost</span> <span class="p">(</span><span class="o">%</span><span class="n">CPU</span><span class="p">)</span><span class="o">|</span> <span class="n">Time</span>     <span class="o">|</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">0</span> <span class="o">|</span> <span class="k">SELECT</span> <span class="k">STATEMENT</span>      <span class="o">|</span>         <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">39</span> <span class="o">|</span>      <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>  <span class="n">MERGE</span> <span class="k">JOIN</span> <span class="n">CARTESIAN</span> <span class="o">|</span>          <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">39</span> <span class="o">|</span>      <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span>   <span class="n">MERGE</span> <span class="k">JOIN</span> <span class="n">CARTESIAN</span><span class="o">|</span>          <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">26</span> <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">3</span> <span class="o">|</span>    <span class="k">INDEX</span> <span class="k">FULL</span> <span class="n">SCAN</span>    <span class="o">|</span> <span class="n">SYS_C0011876</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">4</span> <span class="o">|</span>    <span class="n">BUFFER</span> <span class="n">SORT</span>          <span class="o">|</span>       <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">5</span> <span class="o">|</span>     <span class="k">INDEX</span> <span class="k">FULL</span> <span class="n">SCAN</span>   <span class="o">|</span> <span class="n">SYS_C0011877</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">6</span> <span class="o">|</span>   <span class="n">BUFFER</span> <span class="n">SORT</span>       <span class="o">|</span>       <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>      <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">7</span> <span class="o">|</span>    <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span>  <span class="o">|</span> <span class="n">T3</span>        <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>      <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="k">Data</span>
</span><span class='line'><span class="c1">-------------</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*+</span>
</span><span class='line'><span class="cm">      BEGIN_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">      USE_MERGE_CARTESIAN(@&quot;SEL$1&quot; &quot;T3&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      USE_MERGE_CARTESIAN(@&quot;SEL$1&quot; &quot;T2&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'>
</span><span class='line'><span class="cm">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="cm">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="cm">      LEADING(@&quot;SEL$1&quot; &quot;T1&quot;@&quot;SEL$1&quot; &quot;T2&quot;@&quot;SEL$1&quot; &quot;T3&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$1&quot; &quot;T3&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      INDEX(@&quot;SEL$1&quot; &quot;T2&quot;@&quot;SEL$1&quot; (&quot;T2&quot;.&quot;C2&quot;))</span>
</span><span class='line'><span class="cm">      INDEX(@&quot;SEL$1&quot; &quot;T1&quot;@&quot;SEL$1&quot; (&quot;T1&quot;.&quot;C1&quot;))</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      ALL_ROWS</span>
</span><span class='line'><span class="cm">      DB_VERSION(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      OPTIMIZER_FEATURES_ENABLE(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'><span class="cm">      END_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>
</span><span class='line'><span class="mi">33</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<h3>join含有view的情况</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span>  <span class="n">t1</span><span class="p">,</span> <span class="p">(</span><span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span> <span class="k">from</span> <span class="n">t2</span><span class="p">)</span>  <span class="n">tt</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Explained</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span><span class="p">(</span><span class="n">dbms_xplan</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="s1">&#39;plan_table&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="s1">&#39;outline&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Plan</span> <span class="n">hash</span> <span class="n">value</span><span class="p">:</span> <span class="mi">3649077807</span>
</span><span class='line'>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span> <span class="n">Id</span>  <span class="o">|</span> <span class="k">Operation</span>           <span class="o">|</span> <span class="n">Name</span>       <span class="o">|</span> <span class="k">Rows</span>  <span class="o">|</span> <span class="n">Bytes</span> <span class="o">|</span> <span class="n">Cost</span> <span class="p">(</span><span class="o">%</span><span class="n">CPU</span><span class="p">)</span><span class="o">|</span> <span class="n">Time</span>     <span class="o">|</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">0</span> <span class="o">|</span> <span class="k">SELECT</span> <span class="k">STATEMENT</span>        <span class="o">|</span>       <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">26</span> <span class="o">|</span>      <span class="mi">1</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>  <span class="n">MERGE</span> <span class="k">JOIN</span> <span class="n">CARTESIAN</span>        <span class="o">|</span>       <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">26</span> <span class="o">|</span>      <span class="mi">1</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span>   <span class="k">INDEX</span> <span class="k">FULL</span> <span class="n">SCAN</span>        <span class="o">|</span> <span class="n">SYS_C0011876</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>      <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">3</span> <span class="o">|</span>   <span class="n">BUFFER</span> <span class="n">SORT</span>           <span class="o">|</span>       <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>      <span class="mi">1</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">4</span> <span class="o">|</span>    <span class="k">VIEW</span>            <span class="o">|</span>       <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>      <span class="mi">1</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">5</span> <span class="o">|</span>     <span class="n">SORT</span> <span class="k">AGGREGATE</span>          <span class="o">|</span>       <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>         <span class="o">|</span>       <span class="o">|</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">6</span> <span class="o">|</span>      <span class="k">INDEX</span> <span class="k">FULL</span> <span class="n">SCAN</span> <span class="p">(</span><span class="k">MIN</span><span class="o">/</span><span class="k">MAX</span><span class="p">)</span><span class="o">|</span> <span class="n">SYS_C0011877</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>      <span class="mi">1</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="k">Data</span>
</span><span class='line'><span class="c1">-------------</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*+</span>
</span><span class='line'><span class="cm">      BEGIN_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">      INDEX(@&quot;SEL$2&quot; &quot;T2&quot;@&quot;SEL$2&quot; (&quot;T2&quot;.&quot;C2&quot;))</span>
</span><span class='line'><span class="cm">      USE_MERGE_CARTESIAN(@&quot;SEL$1&quot; &quot;TT&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      LEADING(@&quot;SEL$1&quot; &quot;T1&quot;@&quot;SEL$1&quot; &quot;TT&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'>
</span><span class='line'><span class="cm">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="cm">----------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="cm">      NO_ACCESS(@&quot;SEL$1&quot; &quot;TT&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      INDEX(@&quot;SEL$1&quot; &quot;T1&quot;@&quot;SEL$1&quot; (&quot;T1&quot;.&quot;C1&quot;))</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      ALL_ROWS</span>
</span><span class='line'><span class="cm">      DB_VERSION(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      OPTIMIZER_FEATURES_ENABLE(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'><span class="cm">      END_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>
</span><span class='line'><span class="mi">32</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<h3>busy tree</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="o">*</span><span class="cm">/*+leading(tt, t1,t2) use_nl(t1) use_nl(t2)*/</span> <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="cm">/*+NO_MERGE*/</span><span class="o">*</span> <span class="k">from</span> <span class="n">t3</span><span class="p">,</span><span class="n">t4</span><span class="p">)</span> <span class="n">tt</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Explained</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span><span class="p">(</span><span class="n">dbms_xplan</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="s1">&#39;plan_table&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="s1">&#39;outline&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Plan</span> <span class="n">hash</span> <span class="n">value</span><span class="p">:</span> <span class="mi">276994482</span>
</span><span class='line'>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span> <span class="n">Id</span>  <span class="o">|</span> <span class="k">Operation</span>     <span class="o">|</span> <span class="n">Name</span> <span class="o">|</span> <span class="k">Rows</span>  <span class="o">|</span> <span class="n">Bytes</span> <span class="o">|</span> <span class="n">Cost</span> <span class="p">(</span><span class="o">%</span><span class="n">CPU</span><span class="p">)</span><span class="o">|</span> <span class="n">Time</span>     <span class="o">|</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">0</span> <span class="o">|</span> <span class="k">SELECT</span> <span class="k">STATEMENT</span>  <span class="o">|</span>      <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">52</span> <span class="o">|</span>     <span class="mi">8</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>  <span class="n">MERGE</span> <span class="k">JOIN</span> <span class="n">CARTESIAN</span>  <span class="o">|</span>      <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">52</span> <span class="o">|</span>     <span class="mi">8</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span>   <span class="n">MERGE</span> <span class="k">JOIN</span> <span class="n">CARTESIAN</span> <span class="o">|</span>      <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">26</span> <span class="o">|</span>     <span class="mi">4</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">3</span> <span class="o">|</span>    <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span>   <span class="o">|</span> <span class="n">T1</span>   <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">2</span>    <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">4</span> <span class="o">|</span>    <span class="n">BUFFER</span> <span class="n">SORT</span>        <span class="o">|</span>      <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">5</span> <span class="o">|</span>     <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span>  <span class="o">|</span> <span class="n">T2</span>   <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">2</span>    <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">6</span> <span class="o">|</span>   <span class="n">BUFFER</span> <span class="n">SORT</span>     <span class="o">|</span>      <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">26</span> <span class="o">|</span>     <span class="mi">6</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">7</span> <span class="o">|</span>    <span class="k">VIEW</span>      <span class="o">|</span>      <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">26</span> <span class="o">|</span>     <span class="mi">4</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">8</span> <span class="o">|</span>     <span class="n">MERGE</span> <span class="k">JOIN</span> <span class="n">CARTESIAN</span><span class="o">|</span>      <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">26</span> <span class="o">|</span>     <span class="mi">4</span>  <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">9</span> <span class="o">|</span>      <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span> <span class="o">|</span> <span class="n">T3</span>   <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">2</span>    <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">10</span> <span class="o">|</span>      <span class="n">BUFFER</span> <span class="n">SORT</span>  <span class="o">|</span>      <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">11</span> <span class="o">|</span>       <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span> <span class="o">|</span> <span class="n">T4</span>   <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="k">Data</span>
</span><span class='line'><span class="c1">-------------</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------------------</span>
</span><span class='line'>  <span class="cm">/*+</span>
</span><span class='line'><span class="cm">      BEGIN_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">      USE_MERGE_CARTESIAN(@&quot;SEL$2&quot; &quot;T4&quot;@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      LEADING(@&quot;SEL$2&quot; &quot;T3&quot;@&quot;SEL$2&quot; &quot;T4&quot;@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$2&quot; &quot;T4&quot;@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$2&quot; &quot;T3&quot;@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      USE_MERGE_CARTESIAN(@&quot;SEL$1&quot; &quot;TT&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      USE_MERGE_CARTESIAN(@&quot;SEL$1&quot; &quot;T2&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      LEADING(@&quot;SEL$1&quot; &quot;T1&quot;@&quot;SEL$1&quot; &quot;T2&quot;@&quot;SEL$1&quot; &quot;TT&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      NO_ACCESS(@&quot;SEL$1&quot; &quot;TT&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$1&quot; &quot;T2&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'>
</span><span class='line'><span class="cm">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="cm">----------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$1&quot; &quot;T1&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      ALL_ROWS</span>
</span><span class='line'><span class="cm">      DB_VERSION(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      OPTIMIZER_FEATURES_ENABLE(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'><span class="cm">      END_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>
</span><span class='line'><span class="n">Note</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">----------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="c1">-----</span>
</span><span class='line'>   <span class="o">-</span> <span class="k">dynamic</span> <span class="n">sampling</span> <span class="n">used</span> <span class="k">for</span> <span class="n">this</span> <span class="k">statement</span> <span class="p">(</span><span class="k">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="mi">46</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<h3>指定ordered hint的情况</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="cm">/*+ordered*/</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Explained</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">PLAN_TABLE_OUTPUT</span> <span class="k">FROM</span> <span class="k">TABLE</span><span class="p">(</span><span class="n">DBMS_XPLAN</span><span class="p">.</span><span class="n">DISPLAY</span><span class="p">(</span><span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="s1">&#39;outline&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Plan</span> <span class="n">hash</span> <span class="n">value</span><span class="p">:</span> <span class="mi">787647388</span>
</span><span class='line'>
</span><span class='line'><span class="c1">-----------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span> <span class="n">Id</span>  <span class="o">|</span> <span class="k">Operation</span>      <span class="o">|</span> <span class="n">Name</span> <span class="o">|</span> <span class="k">Rows</span>  <span class="o">|</span> <span class="n">Bytes</span> <span class="o">|</span> <span class="n">Cost</span> <span class="p">(</span><span class="o">%</span><span class="n">CPU</span><span class="p">)</span><span class="o">|</span> <span class="n">Time</span>     <span class="o">|</span>
</span><span class='line'><span class="c1">-----------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">0</span> <span class="o">|</span> <span class="k">SELECT</span> <span class="k">STATEMENT</span>     <span class="o">|</span>     <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">26</span> <span class="o">|</span>      <span class="mi">4</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>  <span class="n">MERGE</span> <span class="k">JOIN</span> <span class="n">CARTESIAN</span><span class="o">|</span>      <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">26</span> <span class="o">|</span>      <span class="mi">4</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span>   <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span>  <span class="o">|</span> <span class="n">T1</span>   <span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>      <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">3</span> <span class="o">|</span>   <span class="n">BUFFER</span> <span class="n">SORT</span>      <span class="o">|</span>       <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>      <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">4</span> <span class="o">|</span>    <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span> <span class="o">|</span> <span class="n">T2</span>   <span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>      <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="c1">-----------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="k">Data</span>
</span><span class='line'><span class="c1">-------------</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*+</span>
</span><span class='line'><span class="cm">      BEGIN_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">      USE_MERGE_CARTESIAN(@&quot;SEL$1&quot; &quot;T2&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      LEADING(@&quot;SEL$1&quot; &quot;T1&quot;@&quot;SEL$1&quot; &quot;T2&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$1&quot; &quot;T2&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$1&quot; &quot;T1&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$1&quot;)</span>
</span><span class='line'>
</span><span class='line'><span class="cm">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="cm">--------------------------------------------------------------------------------</span>
</span><span class='line'><span class="cm">      ALL_ROWS</span>
</span><span class='line'><span class="cm">      DB_VERSION(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      OPTIMIZER_FEATURES_ENABLE(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'><span class="cm">      END_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>
</span><span class='line'><span class="mi">28</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<h3>update outline输出</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">update</span>  <span class="n">t1</span> <span class="k">set</span> <span class="n">c1</span><span class="o">=</span> <span class="mi">100</span> <span class="k">where</span> <span class="n">c1</span><span class="o">=</span><span class="mi">1</span> <span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Explained</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span><span class="p">(</span><span class="n">dbms_xplan</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="s1">&#39;PLAN_TABLE&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="s1">&#39;OUTLINE&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Plan</span> <span class="n">hash</span> <span class="n">value</span><span class="p">:</span> <span class="mi">2927627013</span>
</span><span class='line'>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span> <span class="n">Id</span>  <span class="o">|</span> <span class="k">Operation</span>    <span class="o">|</span> <span class="n">Name</span> <span class="o">|</span> <span class="k">Rows</span>  <span class="o">|</span> <span class="n">Bytes</span> <span class="o">|</span> <span class="n">Cost</span> <span class="p">(</span><span class="o">%</span><span class="n">CPU</span><span class="p">)</span><span class="o">|</span> <span class="n">Time</span>   <span class="o">|</span>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">0</span> <span class="o">|</span> <span class="k">UPDATE</span> <span class="k">STATEMENT</span>   <span class="o">|</span>     <span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>   <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>  <span class="k">UPDATE</span>     <span class="o">|</span> <span class="n">T1</span>   <span class="o">|</span>      <span class="o">|</span>    <span class="o">|</span>         <span class="o">|</span>   <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">2</span> <span class="o">|</span>   <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span><span class="o">|</span> <span class="n">T1</span>   <span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>   <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="k">Data</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------</span>
</span><span class='line'><span class="c1">-------------</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*+</span>
</span><span class='line'><span class="cm">      BEGIN_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">      FULL(@&quot;UPD$1&quot; &quot;T1&quot;@&quot;UPD$1&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;UPD$1&quot;)</span>
</span><span class='line'><span class="cm">      ALL_ROWS</span>
</span><span class='line'><span class="cm">      DB_VERSION(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      OPTIMIZER_FEATURES_ENABLE(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'><span class="cm">      END_OUTLINE_DATA</span>
</span><span class='line'>
</span><span class='line'><span class="cm">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="cm">--------------------------------------------------------------------------------</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>
</span><span class='line'><span class="n">Predicate</span> <span class="n">Information</span> <span class="p">(</span><span class="n">identified</span> <span class="k">by</span> <span class="k">operation</span> <span class="n">id</span><span class="p">):</span>
</span><span class='line'><span class="c1">---------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'>   <span class="mi">2</span> <span class="o">-</span> <span class="n">filter</span><span class="p">(</span><span class="ss">&quot;C1&quot;</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="mi">28</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Oracle对于USE_HASH_AGGREGATION和NO_USE_HASH_AGGREGATION的使用</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span> <span class="p">,</span> <span class="k">version</span> <span class="k">from</span> <span class="n">v</span><span class="err">$</span><span class="n">sql_hint</span> <span class="k">where</span> <span class="k">class</span> <span class="k">like</span> <span class="s1">&#39;%HASH%&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">NAME</span>                                <span class="k">VERSION</span>
</span><span class='line'><span class="c1">---------------------------------------------------------------- -------------------------</span>
</span><span class='line'><span class="n">USE_HASH_AGGREGATION</span>                        <span class="mi">10</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>
</span><span class='line'><span class="n">NO_USE_HASH_AGGREGATION</span>                     <span class="mi">10</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>
</span><span class='line'><span class="n">NO_USE_HASH</span>                             <span class="mi">10</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span>
</span><span class='line'><span class="n">USE_HASH_GBY_FOR_PUSHDOWN</span>                   <span class="mi">11</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span>
</span><span class='line'><span class="n">NO_USE_HASH_GBY_FOR_PUSHDOWN</span>                    <span class="mi">11</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span>
</span></code></pre></td></tr></table></div></figure>


<p>使用USE_HASH_AGGREGATION,看能否生效。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="cm">/*+ USE_HASH_AGGREGATION(@SEL$1)*/</span><span class="k">max</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="k">from</span> <span class="n">t1</span> <span class="k">group</span> <span class="k">by</span> <span class="n">c1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Explained</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span><span class="p">(</span><span class="n">dbms_xplan</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="s1">&#39;plan_table&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="s1">&#39;OUTLINE&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Plan</span> <span class="n">hash</span> <span class="n">value</span><span class="p">:</span> <span class="mi">274432217</span>
</span><span class='line'>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span> <span class="n">Id</span>  <span class="o">|</span> <span class="k">Operation</span>  <span class="o">|</span> <span class="n">Name</span>   <span class="o">|</span> <span class="k">Rows</span>    <span class="o">|</span> <span class="n">Bytes</span> <span class="o">|</span> <span class="n">Cost</span> <span class="p">(</span><span class="o">%</span><span class="n">CPU</span><span class="p">)</span><span class="o">|</span> <span class="n">Time</span>   <span class="o">|</span>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">0</span> <span class="o">|</span> <span class="k">SELECT</span> <span class="k">STATEMENT</span> <span class="o">|</span>     <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>  <span class="n">HASH</span> <span class="k">GROUP</span> <span class="k">BY</span>  <span class="o">|</span>       <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span>   <span class="k">INDEX</span> <span class="k">FULL</span> <span class="n">SCAN</span><span class="o">|</span> <span class="n">SYS_C0012306</span> <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span>     <span class="mi">0</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="c1">---------------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="k">Data</span>
</span><span class='line'><span class="c1">-------------</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*+</span>
</span><span class='line'><span class="cm">      BEGIN_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">      USE_HASH_AGGREGATION(@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      INDEX(@&quot;SEL$1&quot; &quot;T1&quot;@&quot;SEL$1&quot; (&quot;T1&quot;.&quot;C1&quot;))</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      ALL_ROWS</span>
</span><span class='line'><span class="cm">      DB_VERSION(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      OPTIMIZER_FEATURES_ENABLE(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'><span class="cm">      END_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>
</span><span class='line'><span class="mi">24</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>可见，成功使用该HINT。 oracle的当前版本如下。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">v</span><span class="err">$</span><span class="k">version</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">BANNER</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Oracle</span> <span class="k">Database</span> <span class="mi">11</span><span class="k">g</span> <span class="n">Enterprise</span> <span class="n">Edition</span> <span class="n">Release</span> <span class="mi">11</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="mi">64</span><span class="nb">bit</span> <span class="n">Production</span>
</span><span class='line'><span class="n">PL</span><span class="o">/</span><span class="k">SQL</span> <span class="n">Release</span> <span class="mi">11</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">Production</span>
</span><span class='line'><span class="n">CORE</span>   <span class="mi">11</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span>  <span class="n">Production</span>
</span><span class='line'><span class="n">TNS</span> <span class="k">for</span> <span class="n">Linux</span><span class="p">:</span> <span class="k">Version</span> <span class="mi">11</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">Production</span>
</span><span class='line'><span class="n">NLSRTL</span> <span class="k">Version</span> <span class="mi">11</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">Production</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Join的成员中含有subplan filter的情况</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="n">plan</span> <span class="k">into</span> <span class="n">plan_table</span> <span class="k">for</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span> <span class="k">left</span> <span class="k">join</span> <span class="n">t2</span> <span class="k">on</span> <span class="n">t1</span><span class="p">.</span><span class="n">c1</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">t3</span><span class="p">.</span><span class="n">c1</span> <span class="k">from</span> <span class="n">t3</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">Explained</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span><span class="p">(</span><span class="n">dbms_xplan</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="s1">&#39;PLAN_TABLE&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="s1">&#39;OUTLINE&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">PLAN_TABLE_OUTPUT</span>
</span><span class='line'><span class="c1">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Plan</span> <span class="n">hash</span> <span class="n">value</span><span class="p">:</span> <span class="mi">2533311414</span>
</span><span class='line'>
</span><span class='line'><span class="c1">-----------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span> <span class="n">Id</span>  <span class="o">|</span> <span class="k">Operation</span>      <span class="o">|</span> <span class="n">Name</span> <span class="o">|</span> <span class="k">Rows</span>  <span class="o">|</span> <span class="n">Bytes</span> <span class="o">|</span> <span class="n">Cost</span> <span class="p">(</span><span class="o">%</span><span class="n">CPU</span><span class="p">)</span><span class="o">|</span> <span class="n">Time</span>     <span class="o">|</span>
</span><span class='line'><span class="c1">-----------------------------------------------------------------------------</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">0</span> <span class="o">|</span> <span class="k">SELECT</span> <span class="k">STATEMENT</span>     <span class="o">|</span>     <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">52</span> <span class="o">|</span>      <span class="mi">6</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>  <span class="n">NESTED</span> <span class="n">LOOPS</span> <span class="k">OUTER</span>  <span class="o">|</span>      <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">52</span> <span class="o">|</span>      <span class="mi">6</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span>   <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span>  <span class="o">|</span> <span class="n">T1</span>   <span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>     <span class="mi">26</span> <span class="o">|</span>      <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">3</span> <span class="o">|</span>   <span class="k">VIEW</span>            <span class="o">|</span>       <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>     <span class="mi">26</span> <span class="o">|</span>      <span class="mi">4</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">4</span> <span class="o">|</span>    <span class="n">FILTER</span>         <span class="o">|</span>       <span class="o">|</span>        <span class="o">|</span>        <span class="o">|</span>         <span class="o">|</span>       <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">5</span> <span class="o">|</span>     <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span><span class="o">|</span> <span class="n">T2</span>   <span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>     <span class="mi">26</span> <span class="o">|</span>      <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="o">|*</span>  <span class="mi">6</span> <span class="o">|</span>     <span class="k">TABLE</span> <span class="k">ACCESS</span> <span class="k">FULL</span><span class="o">|</span> <span class="n">T3</span>   <span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">2</span>   <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>
</span><span class='line'><span class="c1">-----------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">Outline</span> <span class="k">Data</span>
</span><span class='line'><span class="c1">-------------</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*+</span>
</span><span class='line'><span class="cm">      BEGIN_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$2&quot; &quot;T3&quot;@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$1&quot; &quot;T2&quot;@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      USE_NL(@&quot;SEL$37633EB5&quot; &quot;from$_subquery$_005&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      LEADING(@&quot;SEL$37633EB5&quot; &quot;T1&quot;@&quot;SEL$3&quot; &quot;from$_subquery$_005&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      NO_ACCESS(@&quot;SEL$37633EB5&quot; &quot;from$_subquery$_005&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      FULL(@&quot;SEL$37633EB5&quot; &quot;T1&quot;@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE(@&quot;SEL$4&quot;)</span>
</span><span class='line'><span class="cm">      MERGE(@&quot;SEL$3&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$37633EB5&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$1&quot;)</span>
</span><span class='line'><span class="cm">      OUTLINE_LEAF(@&quot;SEL$2&quot;)</span>
</span><span class='line'><span class="cm">      ALL_ROWS</span>
</span><span class='line'><span class="cm">      DB_VERSION(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      OPTIMIZER_FEATURES_ENABLE(&#39;11.2.0.2&#39;)</span>
</span><span class='line'><span class="cm">      IGNORE_OPTIM_EMBEDDED_HINTS</span>
</span><span class='line'><span class="cm">      END_OUTLINE_DATA</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>
</span><span class='line'><span class="n">Predicate</span> <span class="n">Information</span> <span class="p">(</span><span class="n">identified</span> <span class="k">by</span> <span class="k">operation</span> <span class="n">id</span><span class="p">):</span>
</span><span class='line'><span class="c1">---------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'>   <span class="mi">4</span> <span class="o">-</span> <span class="n">filter</span><span class="p">(</span> <span class="k">EXISTS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="mi">0</span> <span class="k">FROM</span> <span class="ss">&quot;T3&quot;</span> <span class="ss">&quot;T3&quot;</span> <span class="k">WHERE</span> <span class="ss">&quot;T3&quot;</span><span class="p">.</span><span class="ss">&quot;C1&quot;</span><span class="o">=</span><span class="p">:</span><span class="n">B1</span><span class="p">))</span>
</span><span class='line'>   <span class="mi">6</span> <span class="o">-</span> <span class="n">filter</span><span class="p">(</span><span class="ss">&quot;T3&quot;</span><span class="p">.</span><span class="ss">&quot;C1&quot;</span><span class="o">=</span><span class="p">:</span><span class="n">B1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="mi">43</span> <span class="k">rows</span> <span class="n">selected</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/02/12/the-first/">The First</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-02-12T19:35:55+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>7:35 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Hello World</h1>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/08/14/the-use-of-select-for-update/">The Use of Select for Update</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/06/19/oracle-create-outlinegong-neng/">Oracle Create Outline功能</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/06/19/oraclezhong-transformdui-hintde-ying-xiang/">Oracle中transform对hint的影响</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/06/04/gdbchang-yong-ming-ling/">Gdbchang Yong Ming Ling</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/29/zheng-ze-biao-da-shi/">正则表达式</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Yan Tingshuai -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
